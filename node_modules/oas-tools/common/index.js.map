{"version":3,"sources":["../src/index.js"],"names":["validator","ZSchema","ignoreUnresolvableReferences","ignoreUnknownFormats","config","breakOnFirstError","schemaV3","jsyaml","safeLoad","fs","readFileSync","__dirname","fatalError","err","logger","error","init_checks","specDoc","callback","_","isUndefined","Error","isPlainObject","TypeError","isFunction","validate","JSON","stringify","getLastErrors","info","configure","options","setConfigurations","checkOperationId","load","pathName","methodName","methodSection","opId","undefined","rawOpId","has","operationId","utils","generateName","toUpperCase","debug","checkControllers","controllersLocation","controller","router_property","require","getExpressVersion","oasPath","replace","appendBasePath","expressPath","res","servers","specServer","url","split","basePath","charAt","length","slice","i","extendGrants","grantsFile","newGrants","Object","keys","forEach","role","resource","grants","splitRes","paths","specPath","found","pos","splitPath","resPart","foundPos","indexOf","$extend","isJWTScheme","secDef","type","scheme","bearerFormat","initializeSecurityAndAuth","components","securitySchemes","securityFile","secName","substr","_err","_res","body","parse","process","cwd","registerPaths","app","OASRouterMid","OASRouter","call","controllers","OASValidatorMid","OASValidator","OASSecurityMid","OASSecurity","OASAuthMid","OASAuth","dictionary","localServer","find","server","foundServer","join","push","allowedMethods","path","method","includes","myPathObj","hasOwnProperty","toString","router","oasSecurity","oasAuth","docs","apiDocs","apiDocsPrefix","apiSpecDoc","freeze","cloneDeep","use","_req","send","swaggerUi","uiHtml","writeFileSync","swaggerUiPrefix","express","static","pathsDict","initialize","oasDoc","fullSchema","mergeAdditionalProperties","initializeMiddleware","bodyParser","json","strict","middleware","swaggerValidator","EmptyMiddleware","swaggerRouter","swaggerMetadata","swaggerSecurity"],"mappings":"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","sourcesContent":["/*\nOAS-tools module 0.0.0, built on: 2017-03-30\nCopyright (C) 2017 Ignacio Peluaga Lozada (ISA Group)\nhttps://github.com/ignpelloz\nhttps://github.com/isa-group/project-oas-tools\n*/\n\nimport * as _ from \"lodash-compat\";\nimport * as express from \"express\";\nimport * as utils from \"./lib/utils\";\nimport EmptyMiddleware from \"./middleware/empty_middleware\";\nimport OASAuth from \"./middleware/oas-auth\";\nimport OASRouter from \"./middleware/oas-router\";\nimport OASSecurity from \"./middleware/oas-security\";\nimport OASValidator from \"./middleware/oas-validator\";\nimport ZSchema from \"z-schema\";\nimport bodyParser from \"body-parser\";\nimport { config } from \"./configurations\";\nimport deref from \"json-schema-deref-sync\";\nimport fs from \"fs\";\nimport { join } from \"path\";\nimport jsyaml from \"js-yaml\";\nimport request from \"request\";\n\nconst validator = new ZSchema({\n  ignoreUnresolvableReferences: true,\n  ignoreUnknownFormats: config.ignoreUnknownFormats,\n  breakOnFirstError: false,\n});\nconst schemaV3 = jsyaml.safeLoad(\n  fs.readFileSync(join(__dirname, \"./schemas/openapi-3.0.yaml\"), \"utf8\")\n);\n\nfunction fatalError(err) {\n  config.logger.error(err);\n  throw err;\n}\n\n/**\n * Checks that specDoc and callback exist and validates specDoc.\n *@param {object} specDoc - Speceficitation file.\n *@param {object} callback - Callback function passed to the initialization function.\n */\nexport function init_checks(specDoc, callback) {\n  if (_.isUndefined(specDoc)) {\n    throw new Error(\"specDoc is required\");\n  } else if (!_.isPlainObject(specDoc)) {\n    throw new TypeError(\"specDoc must be an object\");\n  }\n\n  if (_.isUndefined(callback)) {\n    throw new Error(\"callback is required\");\n  } else if (!_.isFunction(callback)) {\n    throw new TypeError(\"callback must be a function\");\n  }\n\n  var err = validator.validate(specDoc, schemaV3);\n  if (err == false) {\n    fatalError(\n      \"Specification file is not valid: \" +\n        JSON.stringify(validator.getLastErrors())\n    );\n  } else {\n    config.logger.info(\"Valid specification file\");\n  }\n}\n\n/**\n * Function to set configurations. Initializes local variables that then will be used in the callback inside initializeMiddleware function.\n *@param {object} options - Parameter containing controllers location, enable logs, and strict checks. It can be a STRING or an OBJECT.\n */\nexport function configure(options) {\n  config.setConfigurations(options);\n}\n\n/**\n * Checks if operationId (or generic) and function for it exists on controller for a given pair path-method.\n *@param {object} load - Loaded controller.\n *@param {object} pathName - Path of the spec file to be used to find controller.\n *@param {object} methodName - One of CRUD methods.\n *@param {object} methodSection - Section of the speficication file belonging to methodName.\n */\nfunction checkOperationId(load, pathName, methodName, methodSection) {\n  var opId = undefined;\n  var rawOpId = undefined;\n\n  if (_.has(methodSection, \"operationId\")) {\n    rawOpId = methodSection.operationId;\n    opId = utils.generateName(rawOpId, undefined); //there is opId: just normalize\n  }\n\n  if (opId == undefined) {\n    opId = utils.generateName(pathName, \"function\") + methodName.toUpperCase(); //there is no opId: normalize and add \"func\" at the beggining\n    config.logger.debug(\n      \"      There is no operationId for \" +\n        methodName.toUpperCase() +\n        \" - \" +\n        pathName +\n        \" -> generated: \" +\n        opId\n    );\n  }\n\n  if (load[opId] == undefined) {\n    fatalError(\n      \"      There is no function in the controller for \" +\n        methodName.toUpperCase() +\n        \" - \" +\n        pathName +\n        \" (operationId: \" +\n        opId +\n        \")\"\n    );\n  } else {\n    config.logger.debug(\n      \"      Controller for \" +\n        methodName.toUpperCase() +\n        \" - \" +\n        pathName +\n        \": OK\"\n    );\n  }\n}\n\n/**\n * Checks if exists controller for a given pair path-method.\n *@param {object} pathName - Path of the spec file to be used to find controller.\n *@param {object} methodName - One of CRUD methods.\n *@param {object} methodSection - Section of the speficication file belonging to methodName.\n *@param {object} controllersLocation - Location of controller files.\n */\nfunction checkControllers(\n  pathName,\n  methodName,\n  methodSection,\n  controllersLocation\n) {\n  config.logger.debug(\"  \" + methodName.toUpperCase() + \" - \" + pathName);\n  var controller;\n  var load;\n  var router_property;\n\n  if (methodSection[\"x-router-controller\"] != undefined) {\n    router_property = \"x-router-controller\";\n  } else if (methodSection[\"x-swagger-router-controller\"] != undefined) {\n    router_property = \"x-swagger-router-controller\";\n  } else {\n    router_property = undefined;\n  }\n\n  if (methodSection[router_property] != undefined) {\n    controller = methodSection[router_property];\n    config.logger.debug(\n      \"    OAS-doc has \" + router_property + \" property \" + controller\n    );\n    try {\n      load = require(join(\n        controllersLocation,\n        utils.generateName(controller, undefined)\n      ));\n      checkOperationId(load, pathName, methodName, methodSection);\n    } catch (err) {\n      fatalError(err);\n    }\n  } else {\n    controller = utils.generateName(pathName, \"controller\");\n    config.logger.debug(\n      \"    Spec-file does not have router property -> try generic controller name: \" +\n        controller\n    );\n    try {\n      load = require(join(controllersLocation, controller));\n      checkOperationId(load, pathName, methodName, methodSection);\n    } catch (err) {\n      config.logger.debug(\n        \"    Controller with generic controller name wasn't found either -> try Default one\"\n      );\n      try {\n        controller = \"Default\"; //try to load default one\n        load = require(join(controllersLocation, controller));\n        checkOperationId(load, pathName, methodName, methodSection);\n      } catch (err) {\n        fatalError(\n          \"    There is no controller for \" +\n            methodName.toUpperCase() +\n            \" - \" +\n            pathName\n        );\n      }\n    }\n  }\n}\n\n/**\n * Converts a oas-doc type path into an epxress one.\n * @param {string} oasPath - Path as shown in the oas-doc.\n */\nvar getExpressVersion = function (oasPath) {\n  return oasPath.replace(/{/g, \":\").replace(/}/g, \"\");\n};\n\n/**\n * In case the spec doc has servers.url properties this function appends the base path to the path before registration\n * @param {string} specDoc - Specification file.\n * @param {string} expressPath - Express type path.\n */\nfunction appendBasePath(specDoc, expressPath) {\n  var res;\n  if (specDoc.servers != undefined) {\n    var specServer = specDoc.servers[0].url;\n    var url = specServer.split(\"/\");\n\n    var basePath = \"/\";\n\n    if (specServer.charAt(0) === \"/\") {\n      basePath =\n        specServer.charAt(specServer.length - 1) !== \"/\"\n          ? specServer\n          : specServer.slice(0, -1);\n    } else {\n      for (var i = 0; i < url.length; i++) {\n        if (i >= 3) {\n          basePath += url[i] + \"/\";\n        }\n      }\n      basePath = basePath.slice(0, -1);\n      if (basePath == \"/\") {\n        basePath = \"\";\n      }\n    }\n    config.basePath = basePath;\n    res = basePath + expressPath;\n  } else {\n    res = expressPath;\n  }\n\n  return res;\n}\n\nfunction extendGrants(specDoc, grantsFile) {\n  var newGrants = {};\n  Object.keys(grantsFile).forEach((role) => {\n    newGrants[role] = {};\n    Object.keys(grantsFile[role]).forEach((resource) => {\n      if (resource !== \"$extend\") {\n        var grants = grantsFile[role][resource];\n        var splitRes = resource.split(\"/\");\n        Object.keys(specDoc.paths).forEach((specPath) => {\n          var found = true;\n          var pos = -1;\n          var splitPath = specPath.split(\"/\");\n          splitRes.forEach((resPart) => {\n            var foundPos = splitPath.indexOf(resPart);\n            if (!found || foundPos <= pos) {\n              found = false;\n            }\n          });\n          if (found && !newGrants[role][specPath]) {\n            newGrants[role][specPath] = grants;\n          }\n        });\n      } else {\n        newGrants[role].$extend = grantsFile[role].$extend;\n      }\n    });\n  });\n  return newGrants;\n}\n\nfunction isJWTScheme(secDef) {\n  return (\n    secDef.type === \"http\" &&\n    secDef.scheme === \"bearer\" &&\n    secDef.bearerFormat === \"JWT\"\n  );\n}\n\nfunction initializeSecurityAndAuth(specDoc) {\n  if (specDoc.components && specDoc.components.securitySchemes) {\n    if (!config.securityFile) {\n      config.securityFile = {};\n    }\n    if (!config.grantsFile) {\n      config.grantsFile = {};\n    }\n    Object.keys(specDoc.components.securitySchemes).forEach((secName) => {\n      var secDef = specDoc.components.securitySchemes[secName];\n      if (isJWTScheme(secDef)) {\n        if (secDef[\"x-bearer-config\"] && !config.securityFile[secName]) {\n          config.securityFile[secName] = secDef[\"x-bearer-config\"];\n        }\n        if (secDef[\"x-acl-config\"] && !config.grantsFile[secName]) {\n          config.grantsFile[secName] = secDef[\"x-acl-config\"];\n        }\n      }\n    });\n    Object.keys(config.securityFile).forEach((secName) => {\n      if (\n        typeof config.securityFile[secName] === \"string\" &&\n        isJWTScheme(specDoc.components.securitySchemes[secName])\n      ) {\n        if (config.securityFile[secName].substr(0, 4) === \"http\") {\n          request(config.securityFile[secName], (_err, _res, body) => {\n            config.securityFile[secName] = JSON.parse(body);\n          });\n        } else if (config.securityFile[secName].charAt(0) === \"/\") {\n          config.securityFile[secName] = require(config.securityFile[secName]);\n        } else {\n          config.securityFile[secName] = require(join(\n            process.cwd(),\n            config.securityFile[secName]\n          ));\n        }\n      }\n    });\n    Object.keys(config.grantsFile).forEach((secName) => {\n      if (\n        typeof config.grantsFile[secName] === \"string\" &&\n        isJWTScheme(specDoc.components.securitySchemes[secName])\n      ) {\n        if (config.grantsFile[secName].substr(0, 4) === \"http\") {\n          request(config.grantsFile[secName], (_err, _res, body) => {\n            config.grantsFile[secName] = extendGrants(\n              specDoc,\n              JSON.parse(body)\n            );\n          });\n        } else if (config.grantsFile[secName].charAt(0) === \"/\") {\n          config.grantsFile[secName] = extendGrants(\n            specDoc,\n            require(config.grantsFile[secName])\n          );\n        } else {\n          config.grantsFile[secName] = extendGrants(\n            specDoc,\n            require(join(process.cwd(), config.grantsFile[secName]))\n          );\n        }\n      } else {\n        config.grantsFile[secName] = extendGrants(\n          specDoc,\n          config.grantsFile[secName]\n        );\n      }\n    });\n  }\n}\n\n/**\n * Function to initialize swagger-tools middlewares.\n *@param {object} specDoc - Specification file (dereferenced).\n *@param {function} app - Express application object.\n */\nfunction registerPaths(specDoc, app) {\n  var OASRouterMid = function () {\n    return OASRouter.call(undefined, config.controllers);\n  };\n  var OASValidatorMid = function () {\n    return OASValidator.call(undefined, specDoc);\n  };\n  initializeSecurityAndAuth(specDoc);\n  var OASSecurityMid = function () {\n    return OASSecurity.call(undefined, specDoc);\n  };\n  var OASAuthMid = function () {\n    return OASAuth.call(undefined, specDoc);\n  };\n\n  var dictionary = {};\n\n  if (specDoc.servers) {\n    var localServer = specDoc.servers.find(\n      (server) =>\n        server.url.substr(0, 16) === \"http://localhost\" ||\n        server.url.charAt(0) === \"/\"\n    );\n    if (!localServer) {\n      config.logger.info(\n        \"No localhost or relative server found in spec file, added for testing in Swagger UI\"\n      );\n      var foundServer = specDoc.servers[0];\n      var basePath = \"/\" + foundServer.url.split(\"/\").slice(3).join(\"/\");\n      specDoc.servers.push({\n        url: basePath,\n      });\n    }\n  } else {\n    config.logger.info(\n      \"No servers found in spec file, added relative server for testing in Swagger UI\"\n    );\n    specDoc.servers = [\n      {\n        url: \"/\",\n      },\n    ];\n  }\n\n  var paths = specDoc.paths;\n  //  console.log('specDoc.paths ', specDoc.paths)\n  var allowedMethods = [\n    \"get\",\n    \"post\",\n    \"put\",\n    \"patch\",\n    \"delete\",\n    \"head\",\n    \"options\",\n    \"trace\",\n  ];\n  for (var path in paths) {\n    for (var method in paths[path]) {\n      if (allowedMethods.includes(method)) {\n        // pgillis 2019 June 10\n        var myPathObj = paths[path];\n        //console.log('myPathObj ', myPathObj)\n        //config.logger.debug('PWG ****: '+myPathObj+ \" hasProperty \"+  myPathObj.hasOwnProperty('x-swagger-router-controller'));\n        if (\n          myPathObj.hasOwnProperty(\"x-swagger-router-controller\") &&\n          myPathObj[method].hasOwnProperty(\"x-swagger-router-controller\") ===\n            false\n        ) {\n          myPathObj[method][\"x-swagger-router-controller\"] =\n            myPathObj[\"x-swagger-router-controller\"];\n        }\n        var expressPath = getExpressVersion(path); // TODO: take in account basePath/servers property of the spec doc.\n        dictionary[expressPath.toString()] = path;\n        config.logger.debug(\n          \"Register: \" + method.toUpperCase() + \" - \" + expressPath\n        );\n        if (config.router == true && config.checkControllers == true) {\n          checkControllers(\n            path,\n            method,\n            paths[path][method],\n            config.controllers\n          );\n        }\n        expressPath = appendBasePath(specDoc, expressPath);\n        if (config.oasSecurity == true) {\n          app[method](expressPath, OASSecurityMid());\n        }\n        if (config.oasAuth == true) {\n          app[method](expressPath, OASAuthMid());\n        }\n        if (config.validator == true) {\n          app[method](expressPath, OASValidatorMid());\n        }\n        if (config.router == true) {\n          app[method](expressPath, OASRouterMid());\n        }\n      }\n    }\n  }\n  if (config.docs && config.docs.apiDocs) {\n    if (!config.docs.apiDocsPrefix) {\n      config.docs.apiDocsPrefix = \"\";\n    }\n\n    const apiSpecDoc = Object.freeze(_.cloneDeep(specDoc));\n\n    app.use(config.docs.apiDocsPrefix + config.docs.apiDocs, (_req, res) => {\n      res.send(apiSpecDoc);\n    });\n    if (config.docs.swaggerUi) {\n      var uiHtml = fs.readFileSync(\n        join(__dirname, \"../swagger-ui/index.html\"),\n        \"utf8\"\n      );\n      uiHtml = uiHtml.replace(\n        /url: \"[^\"]*\"/,\n        'url: \"' + config.docs.apiDocsPrefix + config.docs.apiDocs + '\"'\n      );\n      fs.writeFileSync(\n        join(__dirname, \"../swagger-ui/index.html\"),\n        uiHtml,\n        \"utf8\"\n      );\n      if (!config.docs.swaggerUiPrefix) {\n        config.docs.swaggerUiPrefix = \"\";\n      }\n      app.use(\n        config.docs.swaggerUiPrefix + config.docs.swaggerUi,\n        express.static(join(__dirname, \"../swagger-ui\"))\n      );\n    }\n  }\n  config.pathsDict = dictionary;\n}\n\n/**\n * Function to initialize OAS-tools middlewares.\n *@param {object} oasDoc - Specification file.\n *@param {object} app - Express server used for the application. Needed to register the paths.\n *@param {function} callback - Function in which the app is started.\n */\nexport function initialize(oasDoc, app, callback) {\n  init_checks(oasDoc, callback);\n\n  var fullSchema = deref(oasDoc, { mergeAdditionalProperties: true });\n  config.logger.info(\"Specification file dereferenced\");\n\n  registerPaths(fullSchema, app);\n\n  callback();\n}\n\n/**\n * Function to initialize swagger-tools middlewares.\n *@param {object} specDoc - Specification file.\n *@param {function} app - //TODO IN CASE EXPRESS CAN BE USED INSTEAD OF CONNECT, USER MUST PASS THIS TO initializeMiddleware TO REGISTER ROUTES.\n *@param {function} callback - Function that initializes middlewares one by one.\n */\nexport function initializeMiddleware(specDoc, app, callback) {\n  app.use(\n    bodyParser.json({\n      strict: false,\n    })\n  );\n\n  init_checks(specDoc, callback);\n\n  var fullSchema = deref(specDoc);\n  config.logger.info(\"Specification file dereferenced\");\n\n  var middleware = {\n    swaggerValidator: EmptyMiddleware,\n    swaggerRouter: EmptyMiddleware,\n    swaggerMetadata: EmptyMiddleware,\n    swaggerUi: EmptyMiddleware,\n    swaggerSecurity: EmptyMiddleware,\n  };\n  registerPaths(fullSchema, app);\n  callback(middleware);\n}\n"],"file":"index.js"}