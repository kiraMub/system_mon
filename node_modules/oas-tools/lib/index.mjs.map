{"version":3,"sources":["../src/index.js"],"names":["_","express","utils","EmptyMiddleware","OASAuth","OASRouter","OASSecurity","OASValidator","ZSchema","bodyParser","config","deref","fs","join","jsyaml","request","validator","ignoreUnresolvableReferences","ignoreUnknownFormats","breakOnFirstError","schemaV3","safeLoad","readFileSync","__dirname","fatalError","err","logger","error","init_checks","specDoc","callback","isUndefined","Error","isPlainObject","TypeError","isFunction","validate","JSON","stringify","getLastErrors","info","configure","options","setConfigurations","checkOperationId","load","pathName","methodName","methodSection","opId","undefined","rawOpId","has","operationId","generateName","toUpperCase","debug","checkControllers","controllersLocation","controller","router_property","require","getExpressVersion","oasPath","replace","appendBasePath","expressPath","res","servers","specServer","url","split","basePath","charAt","length","slice","i","extendGrants","grantsFile","newGrants","Object","keys","forEach","role","resource","grants","splitRes","paths","specPath","found","pos","splitPath","resPart","foundPos","indexOf","$extend","isJWTScheme","secDef","type","scheme","bearerFormat","initializeSecurityAndAuth","components","securitySchemes","securityFile","secName","substr","_err","_res","body","parse","process","cwd","registerPaths","app","OASRouterMid","call","controllers","OASValidatorMid","OASSecurityMid","OASAuthMid","dictionary","localServer","find","server","foundServer","push","allowedMethods","path","method","includes","myPathObj","hasOwnProperty","toString","router","oasSecurity","oasAuth","docs","apiDocs","apiDocsPrefix","apiSpecDoc","freeze","cloneDeep","use","_req","send","swaggerUi","uiHtml","writeFileSync","swaggerUiPrefix","static","pathsDict","initialize","oasDoc","fullSchema","mergeAdditionalProperties","initializeMiddleware","json","strict","middleware","swaggerValidator","swaggerRouter","swaggerMetadata","swaggerSecurity"],"mappings":"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","sourcesContent":["/*\nOAS-tools module 0.0.0, built on: 2017-03-30\nCopyright (C) 2017 Ignacio Peluaga Lozada (ISA Group)\nhttps://github.com/ignpelloz\nhttps://github.com/isa-group/project-oas-tools\n*/\n\nimport * as _ from \"lodash-compat\";\nimport * as express from \"express\";\nimport * as utils from \"./lib/utils\";\nimport EmptyMiddleware from \"./middleware/empty_middleware\";\nimport OASAuth from \"./middleware/oas-auth\";\nimport OASRouter from \"./middleware/oas-router\";\nimport OASSecurity from \"./middleware/oas-security\";\nimport OASValidator from \"./middleware/oas-validator\";\nimport ZSchema from \"z-schema\";\nimport bodyParser from \"body-parser\";\nimport { config } from \"./configurations\";\nimport deref from \"json-schema-deref-sync\";\nimport fs from \"fs\";\nimport { join } from \"path\";\nimport jsyaml from \"js-yaml\";\nimport request from \"request\";\n\nconst validator = new ZSchema({\n  ignoreUnresolvableReferences: true,\n  ignoreUnknownFormats: config.ignoreUnknownFormats,\n  breakOnFirstError: false,\n});\nconst schemaV3 = jsyaml.safeLoad(\n  fs.readFileSync(join(__dirname, \"./schemas/openapi-3.0.yaml\"), \"utf8\")\n);\n\nfunction fatalError(err) {\n  config.logger.error(err);\n  throw err;\n}\n\n/**\n * Checks that specDoc and callback exist and validates specDoc.\n *@param {object} specDoc - Speceficitation file.\n *@param {object} callback - Callback function passed to the initialization function.\n */\nexport function init_checks(specDoc, callback) {\n  if (_.isUndefined(specDoc)) {\n    throw new Error(\"specDoc is required\");\n  } else if (!_.isPlainObject(specDoc)) {\n    throw new TypeError(\"specDoc must be an object\");\n  }\n\n  if (_.isUndefined(callback)) {\n    throw new Error(\"callback is required\");\n  } else if (!_.isFunction(callback)) {\n    throw new TypeError(\"callback must be a function\");\n  }\n\n  var err = validator.validate(specDoc, schemaV3);\n  if (err == false) {\n    fatalError(\n      \"Specification file is not valid: \" +\n        JSON.stringify(validator.getLastErrors())\n    );\n  } else {\n    config.logger.info(\"Valid specification file\");\n  }\n}\n\n/**\n * Function to set configurations. Initializes local variables that then will be used in the callback inside initializeMiddleware function.\n *@param {object} options - Parameter containing controllers location, enable logs, and strict checks. It can be a STRING or an OBJECT.\n */\nexport function configure(options) {\n  config.setConfigurations(options);\n}\n\n/**\n * Checks if operationId (or generic) and function for it exists on controller for a given pair path-method.\n *@param {object} load - Loaded controller.\n *@param {object} pathName - Path of the spec file to be used to find controller.\n *@param {object} methodName - One of CRUD methods.\n *@param {object} methodSection - Section of the speficication file belonging to methodName.\n */\nfunction checkOperationId(load, pathName, methodName, methodSection) {\n  var opId = undefined;\n  var rawOpId = undefined;\n\n  if (_.has(methodSection, \"operationId\")) {\n    rawOpId = methodSection.operationId;\n    opId = utils.generateName(rawOpId, undefined); //there is opId: just normalize\n  }\n\n  if (opId == undefined) {\n    opId = utils.generateName(pathName, \"function\") + methodName.toUpperCase(); //there is no opId: normalize and add \"func\" at the beggining\n    config.logger.debug(\n      \"      There is no operationId for \" +\n        methodName.toUpperCase() +\n        \" - \" +\n        pathName +\n        \" -> generated: \" +\n        opId\n    );\n  }\n\n  if (load[opId] == undefined) {\n    fatalError(\n      \"      There is no function in the controller for \" +\n        methodName.toUpperCase() +\n        \" - \" +\n        pathName +\n        \" (operationId: \" +\n        opId +\n        \")\"\n    );\n  } else {\n    config.logger.debug(\n      \"      Controller for \" +\n        methodName.toUpperCase() +\n        \" - \" +\n        pathName +\n        \": OK\"\n    );\n  }\n}\n\n/**\n * Checks if exists controller for a given pair path-method.\n *@param {object} pathName - Path of the spec file to be used to find controller.\n *@param {object} methodName - One of CRUD methods.\n *@param {object} methodSection - Section of the speficication file belonging to methodName.\n *@param {object} controllersLocation - Location of controller files.\n */\nfunction checkControllers(\n  pathName,\n  methodName,\n  methodSection,\n  controllersLocation\n) {\n  config.logger.debug(\"  \" + methodName.toUpperCase() + \" - \" + pathName);\n  var controller;\n  var load;\n  var router_property;\n\n  if (methodSection[\"x-router-controller\"] != undefined) {\n    router_property = \"x-router-controller\";\n  } else if (methodSection[\"x-swagger-router-controller\"] != undefined) {\n    router_property = \"x-swagger-router-controller\";\n  } else {\n    router_property = undefined;\n  }\n\n  if (methodSection[router_property] != undefined) {\n    controller = methodSection[router_property];\n    config.logger.debug(\n      \"    OAS-doc has \" + router_property + \" property \" + controller\n    );\n    try {\n      load = require(join(\n        controllersLocation,\n        utils.generateName(controller, undefined)\n      ));\n      checkOperationId(load, pathName, methodName, methodSection);\n    } catch (err) {\n      fatalError(err);\n    }\n  } else {\n    controller = utils.generateName(pathName, \"controller\");\n    config.logger.debug(\n      \"    Spec-file does not have router property -> try generic controller name: \" +\n        controller\n    );\n    try {\n      load = require(join(controllersLocation, controller));\n      checkOperationId(load, pathName, methodName, methodSection);\n    } catch (err) {\n      config.logger.debug(\n        \"    Controller with generic controller name wasn't found either -> try Default one\"\n      );\n      try {\n        controller = \"Default\"; //try to load default one\n        load = require(join(controllersLocation, controller));\n        checkOperationId(load, pathName, methodName, methodSection);\n      } catch (err) {\n        fatalError(\n          \"    There is no controller for \" +\n            methodName.toUpperCase() +\n            \" - \" +\n            pathName\n        );\n      }\n    }\n  }\n}\n\n/**\n * Converts a oas-doc type path into an epxress one.\n * @param {string} oasPath - Path as shown in the oas-doc.\n */\nvar getExpressVersion = function (oasPath) {\n  return oasPath.replace(/{/g, \":\").replace(/}/g, \"\");\n};\n\n/**\n * In case the spec doc has servers.url properties this function appends the base path to the path before registration\n * @param {string} specDoc - Specification file.\n * @param {string} expressPath - Express type path.\n */\nfunction appendBasePath(specDoc, expressPath) {\n  var res;\n  if (specDoc.servers != undefined) {\n    var specServer = specDoc.servers[0].url;\n    var url = specServer.split(\"/\");\n\n    var basePath = \"/\";\n\n    if (specServer.charAt(0) === \"/\") {\n      basePath =\n        specServer.charAt(specServer.length - 1) !== \"/\"\n          ? specServer\n          : specServer.slice(0, -1);\n    } else {\n      for (var i = 0; i < url.length; i++) {\n        if (i >= 3) {\n          basePath += url[i] + \"/\";\n        }\n      }\n      basePath = basePath.slice(0, -1);\n      if (basePath == \"/\") {\n        basePath = \"\";\n      }\n    }\n    config.basePath = basePath;\n    res = basePath + expressPath;\n  } else {\n    res = expressPath;\n  }\n\n  return res;\n}\n\nfunction extendGrants(specDoc, grantsFile) {\n  var newGrants = {};\n  Object.keys(grantsFile).forEach((role) => {\n    newGrants[role] = {};\n    Object.keys(grantsFile[role]).forEach((resource) => {\n      if (resource !== \"$extend\") {\n        var grants = grantsFile[role][resource];\n        var splitRes = resource.split(\"/\");\n        Object.keys(specDoc.paths).forEach((specPath) => {\n          var found = true;\n          var pos = -1;\n          var splitPath = specPath.split(\"/\");\n          splitRes.forEach((resPart) => {\n            var foundPos = splitPath.indexOf(resPart);\n            if (!found || foundPos <= pos) {\n              found = false;\n            }\n          });\n          if (found && !newGrants[role][specPath]) {\n            newGrants[role][specPath] = grants;\n          }\n        });\n      } else {\n        newGrants[role].$extend = grantsFile[role].$extend;\n      }\n    });\n  });\n  return newGrants;\n}\n\nfunction isJWTScheme(secDef) {\n  return (\n    secDef.type === \"http\" &&\n    secDef.scheme === \"bearer\" &&\n    secDef.bearerFormat === \"JWT\"\n  );\n}\n\nfunction initializeSecurityAndAuth(specDoc) {\n  if (specDoc.components && specDoc.components.securitySchemes) {\n    if (!config.securityFile) {\n      config.securityFile = {};\n    }\n    if (!config.grantsFile) {\n      config.grantsFile = {};\n    }\n    Object.keys(specDoc.components.securitySchemes).forEach((secName) => {\n      var secDef = specDoc.components.securitySchemes[secName];\n      if (isJWTScheme(secDef)) {\n        if (secDef[\"x-bearer-config\"] && !config.securityFile[secName]) {\n          config.securityFile[secName] = secDef[\"x-bearer-config\"];\n        }\n        if (secDef[\"x-acl-config\"] && !config.grantsFile[secName]) {\n          config.grantsFile[secName] = secDef[\"x-acl-config\"];\n        }\n      }\n    });\n    Object.keys(config.securityFile).forEach((secName) => {\n      if (\n        typeof config.securityFile[secName] === \"string\" &&\n        isJWTScheme(specDoc.components.securitySchemes[secName])\n      ) {\n        if (config.securityFile[secName].substr(0, 4) === \"http\") {\n          request(config.securityFile[secName], (_err, _res, body) => {\n            config.securityFile[secName] = JSON.parse(body);\n          });\n        } else if (config.securityFile[secName].charAt(0) === \"/\") {\n          config.securityFile[secName] = require(config.securityFile[secName]);\n        } else {\n          config.securityFile[secName] = require(join(\n            process.cwd(),\n            config.securityFile[secName]\n          ));\n        }\n      }\n    });\n    Object.keys(config.grantsFile).forEach((secName) => {\n      if (\n        typeof config.grantsFile[secName] === \"string\" &&\n        isJWTScheme(specDoc.components.securitySchemes[secName])\n      ) {\n        if (config.grantsFile[secName].substr(0, 4) === \"http\") {\n          request(config.grantsFile[secName], (_err, _res, body) => {\n            config.grantsFile[secName] = extendGrants(\n              specDoc,\n              JSON.parse(body)\n            );\n          });\n        } else if (config.grantsFile[secName].charAt(0) === \"/\") {\n          config.grantsFile[secName] = extendGrants(\n            specDoc,\n            require(config.grantsFile[secName])\n          );\n        } else {\n          config.grantsFile[secName] = extendGrants(\n            specDoc,\n            require(join(process.cwd(), config.grantsFile[secName]))\n          );\n        }\n      } else {\n        config.grantsFile[secName] = extendGrants(\n          specDoc,\n          config.grantsFile[secName]\n        );\n      }\n    });\n  }\n}\n\n/**\n * Function to initialize swagger-tools middlewares.\n *@param {object} specDoc - Specification file (dereferenced).\n *@param {function} app - Express application object.\n */\nfunction registerPaths(specDoc, app) {\n  var OASRouterMid = function () {\n    return OASRouter.call(undefined, config.controllers);\n  };\n  var OASValidatorMid = function () {\n    return OASValidator.call(undefined, specDoc);\n  };\n  initializeSecurityAndAuth(specDoc);\n  var OASSecurityMid = function () {\n    return OASSecurity.call(undefined, specDoc);\n  };\n  var OASAuthMid = function () {\n    return OASAuth.call(undefined, specDoc);\n  };\n\n  var dictionary = {};\n\n  if (specDoc.servers) {\n    var localServer = specDoc.servers.find(\n      (server) =>\n        server.url.substr(0, 16) === \"http://localhost\" ||\n        server.url.charAt(0) === \"/\"\n    );\n    if (!localServer) {\n      config.logger.info(\n        \"No localhost or relative server found in spec file, added for testing in Swagger UI\"\n      );\n      var foundServer = specDoc.servers[0];\n      var basePath = \"/\" + foundServer.url.split(\"/\").slice(3).join(\"/\");\n      specDoc.servers.push({\n        url: basePath,\n      });\n    }\n  } else {\n    config.logger.info(\n      \"No servers found in spec file, added relative server for testing in Swagger UI\"\n    );\n    specDoc.servers = [\n      {\n        url: \"/\",\n      },\n    ];\n  }\n\n  var paths = specDoc.paths;\n  //  console.log('specDoc.paths ', specDoc.paths)\n  var allowedMethods = [\n    \"get\",\n    \"post\",\n    \"put\",\n    \"patch\",\n    \"delete\",\n    \"head\",\n    \"options\",\n    \"trace\",\n  ];\n  for (var path in paths) {\n    for (var method in paths[path]) {\n      if (allowedMethods.includes(method)) {\n        // pgillis 2019 June 10\n        var myPathObj = paths[path];\n        //console.log('myPathObj ', myPathObj)\n        //config.logger.debug('PWG ****: '+myPathObj+ \" hasProperty \"+  myPathObj.hasOwnProperty('x-swagger-router-controller'));\n        if (\n          myPathObj.hasOwnProperty(\"x-swagger-router-controller\") &&\n          myPathObj[method].hasOwnProperty(\"x-swagger-router-controller\") ===\n            false\n        ) {\n          myPathObj[method][\"x-swagger-router-controller\"] =\n            myPathObj[\"x-swagger-router-controller\"];\n        }\n        var expressPath = getExpressVersion(path); // TODO: take in account basePath/servers property of the spec doc.\n        dictionary[expressPath.toString()] = path;\n        config.logger.debug(\n          \"Register: \" + method.toUpperCase() + \" - \" + expressPath\n        );\n        if (config.router == true && config.checkControllers == true) {\n          checkControllers(\n            path,\n            method,\n            paths[path][method],\n            config.controllers\n          );\n        }\n        expressPath = appendBasePath(specDoc, expressPath);\n        if (config.oasSecurity == true) {\n          app[method](expressPath, OASSecurityMid());\n        }\n        if (config.oasAuth == true) {\n          app[method](expressPath, OASAuthMid());\n        }\n        if (config.validator == true) {\n          app[method](expressPath, OASValidatorMid());\n        }\n        if (config.router == true) {\n          app[method](expressPath, OASRouterMid());\n        }\n      }\n    }\n  }\n  if (config.docs && config.docs.apiDocs) {\n    if (!config.docs.apiDocsPrefix) {\n      config.docs.apiDocsPrefix = \"\";\n    }\n\n    const apiSpecDoc = Object.freeze(_.cloneDeep(specDoc));\n\n    app.use(config.docs.apiDocsPrefix + config.docs.apiDocs, (_req, res) => {\n      res.send(apiSpecDoc);\n    });\n    if (config.docs.swaggerUi) {\n      var uiHtml = fs.readFileSync(\n        join(__dirname, \"../swagger-ui/index.html\"),\n        \"utf8\"\n      );\n      uiHtml = uiHtml.replace(\n        /url: \"[^\"]*\"/,\n        'url: \"' + config.docs.apiDocsPrefix + config.docs.apiDocs + '\"'\n      );\n      fs.writeFileSync(\n        join(__dirname, \"../swagger-ui/index.html\"),\n        uiHtml,\n        \"utf8\"\n      );\n      if (!config.docs.swaggerUiPrefix) {\n        config.docs.swaggerUiPrefix = \"\";\n      }\n      app.use(\n        config.docs.swaggerUiPrefix + config.docs.swaggerUi,\n        express.static(join(__dirname, \"../swagger-ui\"))\n      );\n    }\n  }\n  config.pathsDict = dictionary;\n}\n\n/**\n * Function to initialize OAS-tools middlewares.\n *@param {object} oasDoc - Specification file.\n *@param {object} app - Express server used for the application. Needed to register the paths.\n *@param {function} callback - Function in which the app is started.\n */\nexport function initialize(oasDoc, app, callback) {\n  init_checks(oasDoc, callback);\n\n  var fullSchema = deref(oasDoc, { mergeAdditionalProperties: true });\n  config.logger.info(\"Specification file dereferenced\");\n\n  registerPaths(fullSchema, app);\n\n  callback();\n}\n\n/**\n * Function to initialize swagger-tools middlewares.\n *@param {object} specDoc - Specification file.\n *@param {function} app - //TODO IN CASE EXPRESS CAN BE USED INSTEAD OF CONNECT, USER MUST PASS THIS TO initializeMiddleware TO REGISTER ROUTES.\n *@param {function} callback - Function that initializes middlewares one by one.\n */\nexport function initializeMiddleware(specDoc, app, callback) {\n  app.use(\n    bodyParser.json({\n      strict: false,\n    })\n  );\n\n  init_checks(specDoc, callback);\n\n  var fullSchema = deref(specDoc);\n  config.logger.info(\"Specification file dereferenced\");\n\n  var middleware = {\n    swaggerValidator: EmptyMiddleware,\n    swaggerRouter: EmptyMiddleware,\n    swaggerMetadata: EmptyMiddleware,\n    swaggerUi: EmptyMiddleware,\n    swaggerSecurity: EmptyMiddleware,\n  };\n  registerPaths(fullSchema, app);\n  callback(middleware);\n}\n"],"file":"index.mjs"}